<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="–ö–∞—Ç–∞–ª–æ–≥ JOHNGALTAZ: —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ CPU/GPU/RAM/SSD/—ç–∫—Ä–∞–Ω—É, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, –∫–æ—Ä–∑–∏–Ω–∞ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏." />
  <title>JOHNGALTAZ ‚Äî –∫–∞—Ç–∞–ª–æ–≥</title>

  <style>
    :root{
      --primary:#0B1416;
      --accent:#F85C58;
      --bg:#F6F6F3;
      --card:#ffffff;
      --muted:#666666;
      --line:#D6D6D6;
      --ok:#0f8a4b;
      --warn:#9a6a00;
      --shadow: 0 10px 30px rgba(11,20,22,.08);
      --radius: 16px;
      --radius2: 22px;
      --max: 1180px;
      --focus: 0 0 0 3px rgba(248,92,88,.25);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:var(--font); color:var(--primary); background:var(--bg); line-height:1.4;}
    a{color:inherit; text-decoration:none}
    button, input, select, textarea{font:inherit}
    .container{max-width:var(--max); margin:0 auto; padding:0 16px}
    .skip{position:absolute; left:-999px; top:auto; width:1px; height:1px; overflow:hidden}
    .skip:focus{left:16px; top:16px; width:auto; height:auto; padding:10px 12px; background:#fff; border-radius:12px; box-shadow:var(--shadow); z-index:9999}

    /* Header */
    header{
      position:sticky; top:0; z-index:60;
      background:rgba(246,246,243,.85);
      backdrop-filter:saturate(1.3) blur(10px);
      border-bottom:1px solid rgba(214,214,214,.6);
    }
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 0}
    .brand{display:flex; align-items:center; gap:12px; min-width:190px}
    .logo{width:44px; height:44px; border-radius:12px; object-fit:cover; background:#fff; box-shadow:0 6px 16px rgba(11,20,22,.08)}
    .brand-title{display:flex; flex-direction:column; gap:2px}
    .brand-title b{letter-spacing:.2px}
    .brand-title small{color:var(--muted); font-size:12px}

    .searchwrap{flex:1; display:flex; gap:10px; align-items:center}
    .search{
      width:100%;
      display:flex; gap:8px; align-items:center;
      background:#fff; border:1px solid var(--line);
      border-radius:999px; padding:10px 12px; box-shadow: 0 6px 18px rgba(11,20,22,.05);
    }
    .search input{border:none; outline:none; width:100%; background:transparent}

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      padding:8px 10px;
      color:var(--primary);
    }
    .chip select{border:none; outline:none; background:transparent; cursor:pointer}

    .actions{display:flex; align-items:center; gap:10px}
    .iconbtn{
      position:relative;
      display:inline-flex; align-items:center; justify-content:center;
      width:42px; height:42px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(11,20,22,.05);
    }
    .iconbtn:focus{outline:none; box-shadow:var(--focus), 0 6px 18px rgba(11,20,22,.05)}
    .badge{
      position:absolute; top:-6px; right:-6px;
      min-width:18px; height:18px; padding:0 5px;
      background:var(--accent); color:#fff; border-radius:999px;
      font-size:11px; display:flex; align-items:center; justify-content:center;
      border:2px solid var(--bg);
    }
    .hamb{display:none}
    nav{padding:0 0 10px 0}
    .navrow{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .navlinks{display:flex; gap:10px; flex-wrap:wrap}
    .navlinks a{padding:8px 12px; border-radius:999px; border:1px solid rgba(214,214,214,0); }
    .navlinks a:hover{background:#fff; border-color:var(--line)}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:10px 14px; border-radius:999px;
      border:1px solid var(--line); background:#fff;
      cursor:pointer; font-weight:700;
    }
    .btn:focus{outline:none; box-shadow:var(--focus)}
    .btn.primary{background:var(--accent); border-color:var(--accent); color:#fff; box-shadow:0 10px 26px rgba(248,92,88,.25)}
    .btn.ghost{background:transparent}
    .muted{color:var(--muted)}
    .small{font-size:12px; color:var(--muted)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid rgba(214,214,214,.85);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      background:rgba(246,246,243,.55);
      color:var(--primary);
    }
    .pill.ok{border-color:rgba(15,138,75,.25); background:rgba(15,138,75,.08)}
    .pill.warn{border-color:rgba(154,106,0,.25); background:rgba(154,106,0,.10)}
    .pill.accent{border-color:rgba(248,92,88,.25); background:rgba(248,92,88,.10)}

    /* Layout */
    main{padding:16px 0 90px}
    .grid{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:12px;
      align-items:start;
    }
    .card{
      background:#fff;
      border:1px solid rgba(214,214,214,.75);
      border-radius:var(--radius2);
      box-shadow:var(--shadow);
    }
    .pad{padding:14px}
    .filters h2{margin:0 0 10px 0; font-size:16px}
    .field{margin-bottom:10px}
    .field label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    .field input, .field select{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      outline:none;
      background:#fff;
    }
    .field input:focus, .field select:focus{box-shadow:var(--focus); border-color:rgba(248,92,88,.45)}
    .range2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .hr{height:1px; background:rgba(214,214,214,.7); margin:12px 0}

    /* Products list */
    .toolbar{
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .toolbar .left{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .toolbar .right{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .count{font-size:13px; color:var(--muted)}
    .products{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    .p{
      overflow:hidden;
      display:flex; flex-direction:column;
      min-height: 360px;
    }
    .pimg{
      width:100%;
      height:170px;
      object-fit:cover;
      background:#fff;
      border-bottom:1px solid rgba(214,214,214,.65);
    }
    .pbody{padding:12px; display:flex; flex-direction:column; gap:10px; flex:1}
    .pname{font-weight:800; font-size:14px}
    .price{display:flex; align-items:baseline; gap:10px; flex-wrap:wrap}
    .price b{font-size:16px}
    .price s{color:var(--muted); font-size:13px}
    .specs{display:flex; flex-wrap:wrap; gap:8px}
    .specs .pill{font-size:11px}
    .pactions{display:flex; flex-wrap:wrap; gap:8px; margin-top:auto}
    .pactions .btn{padding:9px 12px}
    .pactions .btn.primary{flex:1}
    .mini{padding:9px 10px; border-radius:999px; border:1px solid var(--line); background:#fff; cursor:pointer}
    .mini:focus{outline:none; box-shadow:var(--focus)}
    .mini.on{border-color:rgba(248,92,88,.55); background:rgba(248,92,88,.10)}

    /* Modals */
    .overlay{
      position:fixed; inset:0; background:rgba(11,20,22,.45);
      display:none; z-index:200;
    }
    .overlay.show{display:block}
    .modal{
      position:fixed; inset:auto 0 0 0;
      margin:auto;
      width:min(980px, 96vw);
      max-height: min(92vh, 860px);
      top: 50%;
      transform: translateY(-50%);
      background:#fff;
      border:1px solid rgba(214,214,214,.75);
      border-radius:22px;
      box-shadow: 0 20px 90px rgba(11,20,22,.25);
      display:none;
      z-index:210;
      overflow:hidden;
    }
    .modal.show{display:block}
    .mhead{
      display:flex; justify-content:space-between; gap:10px; align-items:center;
      padding:12px 14px;
      border-bottom:1px solid rgba(214,214,214,.65);
      background:rgba(246,246,243,.65);
    }
    .mhead h3{margin:0; font-size:16px}
    .close{border:none; background:transparent; cursor:pointer; font-size:18px; padding:6px 10px; border-radius:12px}
    .close:focus{outline:none; box-shadow:var(--focus)}
    .mbody{padding:14px; overflow:auto; max-height: calc(min(92vh, 860px) - 56px);}

    /* PDP layout */
    .pdp{display:grid; grid-template-columns: 1fr 1.1fr; gap:14px}
    .gallery{border:1px solid rgba(214,214,214,.75); border-radius:18px; overflow:hidden}
    .gallery img{width:100%; height:380px; object-fit:cover; background:#fff}
    .pdp h1{margin:0 0 6px 0; font-size:18px}
    .meta{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
    .tbl{width:100%; border-collapse:collapse; border-radius:16px; overflow:hidden; border:1px solid rgba(214,214,214,.65)}
    .tbl td{padding:10px 10px; border-bottom:1px solid rgba(214,214,214,.5); font-size:13px}
    .tbl tr:last-child td{border-bottom:none}
    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin:12px 0}
    .tab{padding:8px 12px; border-radius:999px; border:1px solid var(--line); background:#fff; cursor:pointer}
    .tab.on{border-color:rgba(248,92,88,.55); background:rgba(248,92,88,.10)}
    .warnbox{border-left:3px solid var(--accent); background:rgba(248,92,88,.07); padding:10px 12px; border-radius:12px}
    .doclink{display:flex; align-items:center; justify-content:space-between; gap:10px; border:1px solid rgba(214,214,214,.65); border-radius:14px; padding:10px 12px; margin-bottom:8px}
    .doclink small{color:var(--muted)}

    /* Compare table */
    .cmpwrap{overflow:auto}
    .cmptbl{border-collapse:collapse; width:100%; min-width:780px; border:1px solid rgba(214,214,214,.65); border-radius:16px; overflow:hidden}
    .cmptbl th, .cmptbl td{padding:10px; border-bottom:1px solid rgba(214,214,214,.5); font-size:13px; vertical-align:top}
    .cmptbl th{background:rgba(246,246,243,.7); text-align:left}
    .diff{background:rgba(248,92,88,.08)}
    .cmphead{display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; margin-bottom:10px}

    /* Floating WA */
    .float-wa{position:fixed; right:16px; bottom:16px; z-index:220}
    .fab{
      width:56px; height:56px; border-radius:999px;
      border:none; cursor:pointer; color:#fff;
      background:var(--accent);
      box-shadow: 0 14px 30px rgba(248,92,88,.35);
      display:flex; align-items:center; justify-content:center;
    }
    .fab:focus{outline:none; box-shadow:var(--focus), 0 14px 30px rgba(248,92,88,.35)}
    .sr{position:absolute; left:-999px; width:1px; height:1px; overflow:hidden}

    /* Mobile */
    @media (max-width: 980px){
      .products{grid-template-columns: repeat(2, 1fr)}
      .grid{grid-template-columns:1fr}
      .hamb{display:inline-flex}
      nav{display:none}
      nav.open{display:block}
      .searchwrap{display:none}
      .pdp{grid-template-columns:1fr}
      .gallery img{height:280px}
      .modal{top:52%; transform:translateY(-50%);}
    }
    @media (max-width: 560px){
      .products{grid-template-columns:1fr}
    }
  </style>
</head>

<body data-page="catalog">
<a class="skip" href="#main">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>

<header>
  <div class="container">
    <div class="topbar">
      <a class="brand" href="index.html" aria-label="JOHNGALTAZ ‚Äî –Ω–∞ –≥–ª–∞–≤–Ω—É—é">
        <img class="logo" src="images/logo.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø JOHNGALTAZ" />
        <div class="brand-title">
          <b>JOHNGALTAZ</b>
          <small id="ui-subtitle">–ö–∞—Ç–∞–ª–æ–≥ ‚Ä¢ –§–∏–ª—å—Ç—Ä—ã ‚Ä¢ –ó–∞–∫–∞–∑</small>
        </div>
      </a>

      <div class="searchwrap" role="search">
        <div class="search" aria-label="–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É">
          <span aria-hidden="true">üîé</span>
          <input id="qTop" placeholder="–ü–æ–∏—Å–∫: –Ω–æ—É—Ç–±—É–∫, RTX 4060, –º–æ–Ω–∏—Ç–æ—Ä..." autocomplete="off" />
          <button class="btn" id="qBtn" type="button">–ù–∞–π—Ç–∏</button>
        </div>
      </div>

      <div class="actions">
        <button class="iconbtn hamb" id="hambBtn" type="button" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">‚ò∞</button>

        <span class="chip" title="–Ø–∑—ã–∫">
          <span aria-hidden="true">üåê</span>
          <select id="langSel" aria-label="–í—ã–±–æ—Ä —è–∑—ã–∫–∞">
            <option value="ru">RU</option>
            <option value="kz">KZ</option>
            <option value="en">EN</option>
          </select>
        </span>

        <span class="chip" title="–í–∞–ª—é—Ç–∞">
          <span aria-hidden="true">üí±</span>
          <select id="curSel" aria-label="–í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã">
            <option value="KZT">KZT</option>
            <option value="RUB">RUB</option>
            <option value="USD">USD</option>
          </select>
        </span>

        <button class="iconbtn" id="wishBtn" type="button" aria-label="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">
          ‚ù§ <span class="badge" id="wishCount">0</span>
        </button>
        <button class="iconbtn" id="cmpBtn" type="button" aria-label="–°—Ä–∞–≤–Ω–µ–Ω–∏–µ">
          ‚â° <span class="badge" id="cmpCount">0</span>
        </button>
        <button class="iconbtn" id="cartBtn" type="button" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">
          üõí <span class="badge" id="cartCount">0</span>
        </button>
      </div>
    </div>

    <nav id="nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
      <div class="navrow">
        <div class="navlinks">
          <a href="index.html" id="navHome">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="catalog.html?cat=laptops" id="navL">–ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏</a>
          <a href="catalog.html?cat=periphery" id="navP">–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è</a>
          <a href="catalog.html?cat=home" id="navH">–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</a>
          <a href="catalog.html?cat=cosmo" id="navC">–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è</a>
          <a href="catalog.html?cat=medical" id="navM">–ú–µ–¥–∏—Ü–∏–Ω–∞</a>
        </div>
        <div class="navlinks">
          <button class="btn primary" id="openCheckout" type="button">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
          <button class="btn" id="askWA" type="button">WhatsApp</button>
        </div>
      </div>
    </nav>
  </div>
</header>

<main id="main" class="container">
  <div class="grid">
    <!-- Filters -->
    <aside class="card pad filters" aria-label="–§–∏–ª—å—Ç—Ä—ã">
      <h2 id="fTitle">–§–∏–ª—å—Ç—Ä—ã</h2>

      <div class="field">
        <label for="catSel" id="fCatL">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="catSel"></select>
      </div>

      <div class="field">
        <label for="q" id="fSearchL">–ü–æ–∏—Å–∫</label>
        <input id="q" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: RTX 4060 / –º–æ–Ω–∏—Ç–æ—Ä" />
      </div>

      <div class="field">
        <label id="fPriceL">–¶–µ–Ω–∞ (KZT, –±–∞–∑–æ–≤–∞—è)</label>
        <div class="range2">
          <input id="pMin" inputmode="numeric" placeholder="–ú–∏–Ω" />
          <input id="pMax" inputmode="numeric" placeholder="–ú–∞–∫—Å" />
        </div>
        <div class="small" id="priceHint" style="margin-top:6px"></div>
      </div>

      <div class="field">
        <label for="brandSel" id="fBrandL">–ë—Ä–µ–Ω–¥</label>
        <select id="brandSel"></select>
      </div>

      <div class="field">
        <label for="stockSel" id="fStockL">–ù–∞–ª–∏—á–∏–µ</label>
        <select id="stockSel">
          <option value="">–õ—é–±–æ–µ</option>
          <option value="in">–í –Ω–∞–ª–∏—á–∏–∏</option>
          <option value="pre">–ü–æ–¥ –∑–∞–∫–∞–∑/–ü—Ä–µ–¥–∑–∞–∫–∞–∑</option>
        </select>
      </div>

      <div id="laptopFilters">
        <div class="hr"></div>
        <div class="small muted" id="lfTitle">–§–∏–ª—å—Ç—Ä—ã –¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤</div>

        <div class="field"><label for="cpuSel">CPU</label><select id="cpuSel"></select></div>
        <div class="field"><label for="gpuSel">GPU</label><select id="gpuSel"></select></div>
        <div class="field"><label for="ramSel">RAM</label><select id="ramSel"></select></div>
        <div class="field"><label for="ssdSel">SSD</label><select id="ssdSel"></select></div>
        <div class="field"><label for="screenSel">–î–∏–∞–≥–æ–Ω–∞–ª—å</label><select id="screenSel"></select></div>
        <div class="field"><label for="hzSel">–ß–∞—Å—Ç–æ—Ç–∞ —ç–∫—Ä–∞–Ω–∞</label><select id="hzSel"></select></div>
        <div class="field"><label for="matrixSel">–¢–∏–ø –º–∞—Ç—Ä–∏—Ü—ã</label><select id="matrixSel"></select></div>
        <div class="field"><label for="osSel">–û–°</label><select id="osSel"></select></div>
      </div>

      <div class="hr"></div>
      <div class="field">
        <button class="btn primary" id="applyBtn" type="button">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <button class="btn" id="resetBtn" type="button">–°–±—Ä–æ—Å</button>
      </div>

      <div class="small muted" id="urlHint">
        URL –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞ (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∞–π—Ç–∞).
      </div>
    </aside>

    <!-- List -->
    <section>
      <div class="toolbar">
        <div class="left">
          <span class="pill" id="crumb">–ö–∞—Ç–∞–ª–æ–≥</span>
          <span class="count" id="count">0 —Ç–æ–≤–∞—Ä–æ–≤</span>
        </div>
        <div class="right">
          <span class="pill" id="preHint">–ü—Ä–µ–¥–∑–∞–∫–∞–∑: ~8 –¥–Ω–µ–π –¥–æ –ê–ª–º–∞—Ç—ã</span>
          <select id="sortSel" class="btn" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞">
            <option value="pop">–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
            <option value="new">–ù–æ–≤–∏–∑–Ω–µ</option>
            <option value="priceAsc">–¶–µ–Ω–µ ‚Üë</option>
            <option value="priceDesc">–¶–µ–Ω–µ ‚Üì</option>
          </select>
        </div>
      </div>

      <div class="products" id="products" aria-live="polite"></div>
      <div class="small muted" id="emptyMsg" style="margin-top:10px; display:none">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.</div>
    </section>
  </div>
</main>

<!-- Modal -->
<div class="overlay" id="overlay" tabindex="-1" aria-hidden="true"></div>

<div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="–û–∫–Ω–æ">
  <div class="mhead">
    <h3 id="mTitle">–û–∫–Ω–æ</h3>
    <button class="close" id="mClose" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
  </div>
  <div class="mbody" id="mBody"></div>
</div>

<!-- Floating WA -->
<div class="float-wa">
  <button class="fab" id="fabWA" type="button" aria-label="WhatsApp">
    <span aria-hidden="true">üí¨</span>
    <span class="sr">WhatsApp</span>
  </button>
</div>

<script>
/* ===========================
   Catalog app (2 files)
   =========================== */

const ADMIN_WA = "+77470436747";
const STORE_KEY = "jg_store_v1";

const I18N = {
  ru: {
    subtitle: "–ö–∞—Ç–∞–ª–æ–≥ ‚Ä¢ –§–∏–ª—å—Ç—Ä—ã ‚Ä¢ –ó–∞–∫–∞–∑",
    filters: "–§–∏–ª—å—Ç—Ä—ã",
    apply: "–ü—Ä–∏–º–µ–Ω–∏—Ç—å",
    reset: "–°–±—Ä–æ—Å",
    any: "–õ—é–±–æ–µ",
    inStock: "–í –Ω–∞–ª–∏—á–∏–∏",
    preorder: "–ü–æ–¥ –∑–∞–∫–∞–∑/–ü—Ä–µ–¥–∑–∞–∫–∞–∑",
    preorderHint: "–ü–æ—Å—Ç–∞–≤–∫–∞ –¥–æ –ê–ª–º–∞—Ç—ã ~ 8 –¥–Ω–µ–π + –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É/–≤ —Ä–µ–≥–∏–æ–Ω—ã",
    addCart: "–í –∫–æ—Ä–∑–∏–Ω—É",
    buyNow: "–ö—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å",
    oneClick: "–í 1 –∫–ª–∏–∫",
    ask: "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å",
    wish: "–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ",
    cmp: "–°—Ä–∞–≤–Ω–∏—Ç—å",
    remove: "–£–±—Ä–∞—Ç—å",
    details: "–ü–æ–¥—Ä–æ–±–Ω–µ–µ",
    specs: "–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏",
    desc: "–û–ø–∏—Å–∞–Ω–∏–µ",
    docs: "–î–æ–∫—É–º–µ–Ω—Ç—ã",
    important: "–í–∞–∂–Ω–æ/–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",
    also: "–° —ç—Ç–∏–º –ø–æ–∫—É–ø–∞—é—Ç",
    similar: "–ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã",
    requestQuote: "–ó–∞–ø—Ä–æ—Å –ö–ü",
    cart: "–ö–æ—Ä–∑–∏–Ω–∞",
    wishlist: "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ",
    compare: "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ",
    checkout: "–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞",
    empty: "–ü–æ–∫–∞ –ø—É—Å—Ç–æ",
    total: "–ò—Ç–æ–≥–æ",
    b2b: "–Æ—Ä. –ª–∏—Ü–æ",
    send: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ WhatsApp",
    city: "–ì–æ—Ä–æ–¥",
    address: "–ê–¥—Ä–µ—Å",
    delivery: "–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏",
    pay: "–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã",
    comment: "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
    company: "–ö–æ–º–ø–∞–Ω–∏—è",
    bin: "–ë–ò–ù/–ò–ù–ù",
    email: "Email –¥–ª—è —Å—á—ë—Ç–∞",
    contact: "–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ",
    attach: "–†–µ–∫–≤–∏–∑–∏—Ç—ã (—Ñ–∞–π–ª)",
  },
  kz: {
    subtitle: "–ö–∞—Ç–∞–ª–æ–≥ ‚Ä¢ –°“Ø–∑–≥—ñ–ª–µ—Ä ‚Ä¢ –¢–∞–ø—Å—ã—Ä—ã—Å",
    filters: "–°“Ø–∑–≥—ñ–ª–µ—Ä",
    apply: "“ö–æ–ª–¥–∞–Ω—É",
    reset: "–¢–∞–∑–∞–ª–∞—É",
    any: "–ö–µ–∑ –∫–µ–ª–≥–µ–Ω",
    inStock: "“ö–æ–π–º–∞–¥–∞ –±–∞—Ä",
    preorder: "–¢–∞–ø—Å—ã—Ä—ã—Å–ø–µ–Ω/–ê–ª–¥—ã–Ω –∞–ª–∞",
    preorderHint: "–ê–ª–º–∞—Ç—ã“ì–∞ ~ 8 –∫“Ø–Ω + “õ–∞–ª–∞/–∞–π–º–∞“õ“õ–∞ –∂–µ—Ç–∫—ñ–∑—É",
    addCart: "–°–µ–±–µ—Ç–∫–µ",
    buyNow: "“ö–∞–∑—ñ—Ä –∞–ª—É",
    oneClick: "1 —à–µ—Ä—Ç—É",
    ask: "–°“±—Ä–∞“õ “õ–æ—é",
    wish: "–¢–∞“£–¥–∞—É–ª—ã“ì–∞",
    cmp: "–°–∞–ª—ã—Å—Ç—ã—Ä—É",
    remove: "–ñ–æ—é",
    details: "–¢–æ–ª—ã“ì—ã—Ä–∞“õ",
    specs: "–°–∏–ø–∞—Ç—Ç–∞–º–∞",
    desc: "–°–∏–ø–∞—Ç—Ç–∞–º–∞ (–º”ô—Ç—ñ–Ω)",
    docs: "“ö“±–∂–∞—Ç—Ç–∞—Ä",
    important: "–ú–∞“£—ã–∑–¥—ã/–µ—Å–∫–µ—Ä—Ç—É",
    also: "“ö–æ—Å—ã–º—à–∞",
    similar: "“∞“õ—Å–∞—Å",
    requestQuote: "–ö–ü —Å“±—Ä–∞—É",
    cart: "–°–µ–±–µ—Ç",
    wishlist: "–¢–∞“£–¥–∞—É–ª—ã–ª–∞—Ä",
    compare: "–°–∞–ª—ã—Å—Ç—ã—Ä—É",
    checkout: "–¢–∞–ø—Å—ã—Ä—ã—Å —Ä”ô—Å—ñ–º–¥–µ—É",
    empty: "”ò–∑—ñ—Ä–≥–µ –±–æ—Å",
    total: "–ñ–∏—ã–Ω—ã",
    b2b: "–ó–∞“£–¥—ã —Ç“±–ª“ì–∞",
    send: "WhatsApp –∂—ñ–±–µ—Ä—É",
    city: "“ö–∞–ª–∞",
    address: "–ú–µ–∫–µ–Ω–∂–∞–π",
    delivery: "–ñ–µ—Ç–∫—ñ–∑—É —Ç”ô—Å—ñ–ª—ñ",
    pay: "–¢”©–ª–µ–º —Ç”ô—Å—ñ–ª—ñ",
    comment: "–ü—ñ–∫—ñ—Ä",
    company: "–ö–æ–º–ø–∞–Ω–∏—è",
    bin: "–ë–ò–ù/–ò–ù–ù",
    email: "–®–æ—Ç“õ–∞ email",
    contact: "–ë–∞–π–ª–∞–Ω—ã—Å —Ç“±–ª“ì–∞—Å—ã",
    attach: "–†–µ–∫–≤–∏–∑–∏—Ç (—Ñ–∞–π–ª)",
  },
  en: {
    subtitle: "Catalog ‚Ä¢ Filters ‚Ä¢ Order",
    filters: "Filters",
    apply: "Apply",
    reset: "Reset",
    any: "Any",
    inStock: "In stock",
    preorder: "Preorder",
    preorderHint: "~8 days to Almaty + local/regions delivery",
    addCart: "Add to cart",
    buyNow: "Buy now",
    oneClick: "1-click",
    ask: "Ask",
    wish: "Wishlist",
    cmp: "Compare",
    remove: "Remove",
    details: "Details",
    specs: "Specs",
    desc: "Description",
    docs: "Documents",
    important: "Important / warnings",
    also: "Frequently bought together",
    similar: "Similar items",
    requestQuote: "Request a quote",
    cart: "Cart",
    wishlist: "Wishlist",
    compare: "Compare",
    checkout: "Checkout",
    empty: "It‚Äôs empty for now",
    total: "Total",
    b2b: "Business",
    send: "Send to WhatsApp",
    city: "City",
    address: "Address",
    delivery: "Delivery method",
    pay: "Payment method",
    comment: "Comment",
    company: "Company",
    bin: "Tax ID",
    email: "Invoice email",
    contact: "Contact person",
    attach: "Company details (file)",
  }
};

const FX = { KZT:1, RUB:0.20, USD:0.0022 };

function loadState(){
  const raw = localStorage.getItem(STORE_KEY);
  return raw ? JSON.parse(raw) : { lang:"ru", cur:"KZT", cart:[], wish:[], cmp:[] };
}
function saveState(s){ localStorage.setItem(STORE_KEY, JSON.stringify(s)); }
function fmtMoney(kzt, cur){
  const rate = FX[cur] ?? 1;
  const val = kzt * rate;
  const opt = { maximumFractionDigits: cur==="KZT" ? 0 : 2 };
  return new Intl.NumberFormat(undefined, opt).format(val) + " " + cur;
}
function waLink(text){
  const msg = encodeURIComponent(text);
  const phone = ADMIN_WA.replace(/\D/g,"");
  return `https://wa.me/${phone}?text=${msg}`;
}
function openWA(text){
  window.open(waLink(text), "_blank", "noopener,noreferrer");
}

const state = loadState();
document.getElementById("langSel").value = state.lang;
document.getElementById("curSel").value = state.cur;

/* ===== Data: 50 —Ç–æ–≤–∞—Ä–æ–≤ (–ø—Ä–∏–º–µ—Ä) =====
   –ö–∞—Ä—Ç–∏–Ω–∫–∏: images/tovar1.jpg ... images/tovar50.jpg
   –õ–û–ì–ò–ö–ê: 1 —Ñ–∞–π–ª catalog.html —Ö—Ä–∞–Ω–∏—Ç –≤–∏—Ç—Ä–∏–Ω—É –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Ç–æ–º –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ JSON/–∞–¥–º–∏–Ω–∫—É).
*/
const CATEGORIES = [
  { id:"",        name:{ru:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", kz:"–ë–∞—Ä–ª—ã“õ —Å–∞–Ω–∞—Ç—Ç–∞—Ä", en:"All categories"}, kind:"any" },
  { id:"laptops", name:{ru:"–ò–≥—Ä–æ–≤—ã–µ –Ω–æ—É—Ç–±—É–∫–∏", kz:"–û–π—ã–Ω –Ω–æ—É—Ç–±—É–∫—Ç–∞—Ä—ã", en:"Gaming laptops"}, kind:"laptop" },
  { id:"periphery", name:{ru:"–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è", kz:"–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è", en:"Peripherals"}, kind:"other" },
  { id:"home", name:{ru:"–ú–µ–ª–∫–æ-–±—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞", kz:"–¢“±—Ä–º—ã—Å—Ç—ã“õ —Ç–µ—Ö–Ω–∏–∫–∞", en:"Home appliances"}, kind:"other" },
  { id:"cosmo", name:{ru:"–ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ", kz:"–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è –∂–∞–±–¥—ã“ì—ã", en:"Cosmetology equipment"}, kind:"docs" },
  { id:"medical", name:{ru:"–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ", kz:"–ú–µ–¥–∏—Ü–∏–Ω–∞–ª—ã“õ –∂–∞–±–¥—ã“õ", en:"Medical equipment"}, kind:"docs" },
];

const BRANDS = ["THUNDEROBOT","ASUS","MSI","Acer","Lenovo","HP","Logitech","Razer","Philips","Xiaomi","Beurer","Omron"];
const CPU = ["Intel i5","Intel i7","Intel i9","Ryzen 5","Ryzen 7","Ryzen 9"];
const GPU = ["RTX 4050","RTX 4060","RTX 4070","RTX 4080","RTX 4090"];
const RAM = ["16 GB","32 GB","64 GB"];
const SSD = ["512 GB","1 TB","2 TB"];
const SCREEN = ["15.6\"","16\"","17.3\""];
const HZ = ["144 Hz","165 Hz","240 Hz"];
const MATRIX = ["IPS","OLED"];
const OS = ["Windows 11","–ë–µ–∑ –û–°"];

function pick(arr, i){ return arr[i % arr.length]; }
function randBetween(min,max, i){ // –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø–æ i
  const x = Math.sin((i+1)*999) * 10000;
  const r = x - Math.floor(x);
  return Math.floor(min + r*(max-min+1));
}

function genProducts(){
  const items = [];
  let skuNum = 1;

  // 25 laptops
  for(let i=1;i<=25;i++){
    const brand = pick(BRANDS.slice(0,6), i);
    const cpu = pick(CPU, i);
    const gpu = pick(GPU, i);
    const ram = pick(RAM, i);
    const ssd = pick(SSD, i);
    const screen = pick(SCREEN, i);
    const hz = pick(HZ, i);
    const matrix = pick(MATRIX, i);
    const os = pick(OS, i);
    const base = randBetween(420000, 1650000, i);
    const sale = (i%5===0) ? Math.round(base*1.12) : null; // —Å—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞
    const stock = (i%3===0) ? "pre" : "in";
    const leadDays = stock==="pre" ? 8 : 0;

    const model = `Gaming ${brand} ${gpu} (${screen} ${hz})`;

    // –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–∞–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–ø—Ä–∏–º–µ—Ä)
    const variants = [
      { vid:1, name:`${ram} / ${ssd}`, priceKZT: base, stock },
      { vid:2, name:`${ram==="16 GB"?"32 GB":"64 GB"} / ${ssd}`, priceKZT: Math.round(base*1.12), stock: (i%4===0)?"pre":"in" },
    ];

    items.push({
      id: `JG-${String(skuNum++).padStart(4,"0")}`,
      cat: "laptops",
      brand,
      name: { ru: model, kz: model, en: model },
      img: `tovar${i}.jpg`,
      priceKZT: base,
      oldPriceKZT: sale,
      stock,
      leadDays,
      popularity: randBetween(1,100, i*3),
      createdAt: Date.now() - randBetween(1, 120, i)*86400000,
      laptop: { cpu, gpu, ram, ssd, screen, hz, matrix, os, skuNote:`SKU-${i}` },
      desc: {
        ru: `–ö–æ–º—É –ø–æ–¥–æ–π–¥—ë—Ç: –∏–≥—Ä—ã –∏ —Ä–∞–±–æ—Ç–∞. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: ${gpu}, ${hz}, –±—ã—Å—Ç—Ä—ã–π SSD. –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è: –Ω–æ—É—Ç–±—É–∫, –∑–∞—Ä—è–¥–∫–∞, –¥–æ–∫—É–º–µ–Ω—Ç—ã.`,
        kz: `–û–π—ã–Ω –∂”ô–Ω–µ –∂“±–º—ã—Å“õ–∞. –ê—Ä—Ç—ã“õ—à—ã–ª—ã“õ—Ç–∞—Ä—ã: ${gpu}, ${hz}, –∂—ã–ª–¥–∞–º SSD. –ñ–∏—ã–Ω—Ç—ã“õ: –Ω–æ—É—Ç–±—É–∫, –∑–∞—Ä—è–¥—Ç–∞“ì—ã—à, “õ“±–∂–∞—Ç—Ç–∞—Ä.`,
        en: `For gaming and work. Highlights: ${gpu}, ${hz}, fast SSD. Box: laptop, charger, docs.`
      },
      docs: [],
      warning: "",
      quoteOnly: false,
      variants
    });
  }

  // 10 periphery (tovar26-35)
  for(let i=26;i<=35;i++){
    const brand = pick(BRANDS.slice(6,9), i);
    const base = randBetween(12000, 280000, i);
    const stock = (i%4===0) ? "pre" : "in";
    items.push({
      id:`JG-${String(skuNum++).padStart(4,"0")}`,
      cat:"periphery",
      brand,
      name:{ru:`${brand} –∞–∫—Å–µ—Å—Å—É–∞—Ä #${i-25}`, kz:`${brand} –∞–∫—Å–µ—Å—Å—É–∞—Ä #${i-25}`, en:`${brand} accessory #${i-25}`},
      img:`tovar${i}.jpg`,
      priceKZT: base,
      oldPriceKZT: (i%6===0) ? Math.round(base*1.15) : null,
      stock,
      leadDays: stock==="pre"?8:0,
      popularity: randBetween(1,100, i*2),
      createdAt: Date.now() - randBetween(1, 120, i)*86400000,
      laptop:null,
      desc:{
        ru:"–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–µ—Ä–∏—Ñ–µ—Ä–∏–∏. –î–æ–±–∞–≤–∏–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø–æ–∑–∂–µ.",
        kz:"–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è —Å–∏–ø–∞—Ç—Ç–∞–º–∞—Å—ã (“õ—ã—Å“õ–∞—à–∞). –ö–µ–π—ñ–Ω —Ç–æ–ª—ã“õ—Ç—ã—Ä–∞–º—ã–∑.",
        en:"Peripheral item short description. Specs can be added later."
      },
      docs:[],
      warning:"",
      quoteOnly:false,
      variants:[{vid:1,name:"–°—Ç–∞–Ω–¥–∞—Ä—Ç",priceKZT:base,stock}]
    });
  }

  // 7 home (tovar36-42)
  for(let i=36;i<=42;i++){
    const brand = pick(BRANDS.slice(8,10), i);
    const base = randBetween(18000, 240000, i);
    const stock = (i%5===0) ? "pre" : "in";
    items.push({
      id:`JG-${String(skuNum++).padStart(4,"0")}`,
      cat:"home",
      brand,
      name:{ru:`${brand} —Ç–µ—Ö–Ω–∏–∫–∞ #${i-35}`, kz:`${brand} —Ç–µ—Ö–Ω–∏–∫–∞ #${i-35}`, en:`${brand} appliance #${i-35}`},
      img:`tovar${i}.jpg`,
      priceKZT: base,
      oldPriceKZT: null,
      stock,
      leadDays: stock==="pre"?8:0,
      popularity: randBetween(1,100, i),
      createdAt: Date.now() - randBetween(1, 120, i)*86400000,
      laptop:null,
      desc:{
        ru:"–ú–µ–ª–∫–æ-–±—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞. –î–æ–±–∞–≤–∏–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–∑–∂–µ.",
        kz:"–¢“±—Ä–º—ã—Å—Ç—ã“õ —Ç–µ—Ö–Ω–∏–∫–∞. –ö–µ–π—ñ–Ω —Å–∏–ø–∞—Ç—Ç–∞–º–∞–ª–∞—Ä–¥—ã “õ–æ—Å–∞–º—ã–∑.",
        en:"Small home appliance. Specs/variants can be added later."
      },
      docs:[],
      warning:"",
      quoteOnly:false,
      variants:[{vid:1,name:"–°—Ç–∞–Ω–¥–∞—Ä—Ç",priceKZT:base,stock}]
    });
  }

  // 4 cosmo (tovar43-46) ‚Äî quoteOnly
  for(let i=43;i<=46;i++){
    const brand = pick(BRANDS.slice(10,12), i);
    const base = randBetween(250000, 2200000, i);
    const stock = "pre";
    items.push({
      id:`JG-${String(skuNum++).padStart(4,"0")}`,
      cat:"cosmo",
      brand,
      name:{ru:`${brand} –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è #${i-42}`, kz:`${brand} –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è #${i-42}`, en:`${brand} cosmetology #${i-42}`},
      img:`tovar${i}.jpg`,
      priceKZT: base,
      oldPriceKZT: null,
      stock,
      leadDays: 8,
      popularity: randBetween(1,100, i),
      createdAt: Date.now() - randBetween(1, 120, i)*86400000,
      laptop:null,
      desc:{
        ru:"–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏–∏. –ü—Ä–æ–¥–∞–∂–∞/—É—Å–ª–æ–≤–∏—è ‚Äî —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –∏ –ö–ü.",
        kz:"–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è –∂–∞–±–¥—ã“ì—ã. –°–∞—Ç—É/—à–∞—Ä—Ç—Ç–∞—Ä ‚Äî –∫–µ“£–µ—Å –∂”ô–Ω–µ –ö–ü –∞—Ä“õ—ã–ª—ã.",
        en:"Cosmetology equipment. Sold via consultation / quote."
      },
      docs:[
        {name:"–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è (–ø—Ä–∏–º–µ—Ä)", note:"PDF / JPG (–∑–∞–≥–ª—É—à–∫–∞)"},
        {name:"–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–ø—Ä–∏–º–µ—Ä)", note:"PDF (–∑–∞–≥–ª—É—à–∫–∞)"}
      ],
      warning:"–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞. –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è. –¢–æ—á–Ω—ã–π –ø–µ—Ä–µ—á–µ–Ω—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∑–∞–¥–∞—ë—Ç—Å—è –∏–∑ –∞–¥–º–∏–Ω–∫–∏ (–≤ –±—É–¥—É—â–µ–º).",
      quoteOnly:true,
      variants:[{vid:1,name:"–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è 1",priceKZT:base,stock}]
    });
  }

  // 4 medical (tovar47-50) ‚Äî quoteOnly
  for(let i=47;i<=50;i++){
    const brand = pick(BRANDS.slice(10,12), i+1);
    const base = randBetween(180000, 2500000, i);
    const stock = "pre";
    items.push({
      id:`JG-${String(skuNum++).padStart(4,"0")}`,
      cat:"medical",
      brand,
      name:{ru:`${brand} –º–µ–¥–∏—Ü–∏–Ω–∞ #${i-46}`, kz:`${brand} –º–µ–¥–∏—Ü–∏–Ω–∞ #${i-46}`, en:`${brand} medical #${i-46}`},
      img:`tovar${i}.jpg`,
      priceKZT: base,
      oldPriceKZT: null,
      stock,
      leadDays: 8,
      popularity: randBetween(1,100, i),
      createdAt: Date.now() - randBetween(1, 120, i)*86400000,
      laptop:null,
      desc:{
        ru:"–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ. –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.",
        kz:"–ú–µ–¥–∏—Ü–∏–Ω–∞–ª—ã“õ –∂–∞–±–¥—ã“õ. “ö“±–∂–∞—Ç—Ç–∞—Ä –º–µ–Ω —Ç–∞–ª–∞–ø—Ç–∞—Ä –º—ñ–Ω–¥–µ—Ç—Ç—ñ.",
        en:"Medical equipment. Documents and requirements are required."
      },
      docs:[
        {name:"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ (–ø—Ä–∏–º–µ—Ä)", note:"PDF (–∑–∞–≥–ª—É—à–∫–∞)"},
        {name:"–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç/–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–ø—Ä–∏–º–µ—Ä)", note:"PDF (–∑–∞–≥–ª—É—à–∫–∞)"}
      ],
      warning:"–í–∞–∂–Ω–æ: –∏–∑–¥–µ–ª–∏–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏. –¢–µ–∫—Å—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∑–∞–¥–∞—ë—Ç—Å—è –∏–∑ –∞–¥–º–∏–Ω–∫–∏ (–≤ –±—É–¥—É—â–µ–º).",
      quoteOnly:true,
      variants:[{vid:1,name:"–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è 1",priceKZT:base,stock}]
    });
  }

  return items;
}

const PRODUCTS = genProducts();

/* ===== Helpers ===== */
function t(key){ return (I18N[state.lang]||I18N.ru)[key] || key; }
function productName(p){ return p.name?.[state.lang] || p.name?.ru || p.id; }
function stockPill(p){
  if(p.stock==="in") return `<span class="pill ok">${t("inStock")}</span>`;
  return `<span class="pill warn">${t("preorder")}</span>`;
}
function preorderNote(p){
  return p.stock==="pre" ? `<span class="pill accent">${t("preorderHint")}</span>` : "";
}
function setCounts(){
  document.getElementById("wishCount").textContent = state.wish.length;
  document.getElementById("cmpCount").textContent = state.cmp.length;
  document.getElementById("cartCount").textContent = state.cart.reduce((a,i)=>a+i.qty,0);
}
function applyI18N(){
  document.getElementById("ui-subtitle").textContent = t("subtitle");
  document.getElementById("fTitle").textContent = t("filters");
  document.getElementById("applyBtn").textContent = t("apply");
  document.getElementById("resetBtn").textContent = t("reset");
  document.getElementById("preHint").textContent = t("preorderHint");
}
function qsParse(){
  const p = new URLSearchParams(location.search);
  const obj = {};
  for(const [k,v] of p.entries()) obj[k]=v;
  return obj;
}
function qsSet(obj){
  const p = new URLSearchParams();
  Object.entries(obj).forEach(([k,v])=>{
    if(v!==undefined && v!==null && String(v).trim()!=="") p.set(k, v);
  });
  const url = location.pathname + "?" + p.toString();
  history.replaceState(null,"",url);
}
function uniqueOptions(list, getter){
  const set = new Set();
  list.forEach(x=>{ const v=getter(x); if(v) set.add(v); });
  return ["", ...Array.from(set).sort((a,b)=>String(a).localeCompare(String(b)))];
}
function fillSelect(sel, options, labelAny){
  sel.innerHTML = "";
  options.forEach((opt,i)=>{
    const o=document.createElement("option");
    o.value = opt;
    o.textContent = opt==="" ? (labelAny ?? t("any")) : opt;
    sel.appendChild(o);
  });
}
function clampNum(v, min, max){
  const n = Number(v);
  if(Number.isNaN(n)) return null;
  return Math.min(max, Math.max(min, n));
}

/* ===== Filters UI init ===== */
const catSel = document.getElementById("catSel");
catSel.innerHTML = CATEGORIES.map(c=>`<option value="${c.id}">${c.name[state.lang]||c.name.ru}</option>`).join("");

function refreshCatNames(){
  catSel.innerHTML = CATEGORIES.map(c=>`<option value="${c.id}">${c.name[state.lang]||c.name.ru}</option>`).join("");
}

const brandSel = document.getElementById("brandSel");
const cpuSel = document.getElementById("cpuSel");
const gpuSel = document.getElementById("gpuSel");
const ramSel = document.getElementById("ramSel");
const ssdSel = document.getElementById("ssdSel");
const screenSel = document.getElementById("screenSel");
const hzSel = document.getElementById("hzSel");
const matrixSel = document.getElementById("matrixSel");
const osSel = document.getElementById("osSel");

fillSelect(brandSel, uniqueOptions(PRODUCTS, p=>p.brand), t("any"));
fillSelect(cpuSel, uniqueOptions(PRODUCTS.filter(p=>p.cat==="laptops"), p=>p.laptop?.cpu));
fillSelect(gpuSel, uniqueOptions(PRODUCTS.filter(p=>p.cat==="laptops"), p=>p.laptop?.gpu));
fillSelect(ramSel, uniqueOptions(PRODUCTS.filter(p=>p.cat==="laptops"), p=>p.laptop?.ram));
fillSelect(ssdSel, uniqueOptions(PRODUCTS.filter(p=>p.cat==="laptops"), p=>p.laptop?.ssd));
fillSelect(screenSel, uniqueOptions(PRODUCTS.filter(p=>p.cat==="laptops"), p=>p.laptop?.screen));
fillSelect(hzSel, uniqueOptions(PRODUCTS.filter(p=>p.cat==="laptops"), p=>p.laptop?.hz));
fillSelect(matrixSel, uniqueOptions(PRODUCTS.filter(p=>p.cat==="laptops"), p=>p.laptop?.matrix));
fillSelect(osSel, uniqueOptions(PRODUCTS.filter(p=>p.cat==="laptops"), p=>p.laptop?.os));

/* ===== Rendering products ===== */
function filterProducts(params){
  let list = PRODUCTS.slice();

  // category
  if(params.cat) list = list.filter(p=>p.cat===params.cat);

  // search
  const q = (params.q || "").trim().toLowerCase();
  if(q){
    list = list.filter(p=>{
      const s = (productName(p)+" "+p.brand+" "+(p.laptop?Object.values(p.laptop).join(" "):"")).toLowerCase();
      return s.includes(q);
    });
  }

  // price (base KZT)
  const minP = params.pMin ? Number(params.pMin) : null;
  const maxP = params.pMax ? Number(params.pMax) : null;
  if(minP!==null && !Number.isNaN(minP)) list = list.filter(p=>p.priceKZT>=minP);
  if(maxP!==null && !Number.isNaN(maxP)) list = list.filter(p=>p.priceKZT<=maxP);

  // brand
  if(params.brand) list = list.filter(p=>p.brand===params.brand);

  // stock
  if(params.stock==="in") list = list.filter(p=>p.stock==="in");
  if(params.stock==="pre") list = list.filter(p=>p.stock==="pre");

  // laptop filters
  const laptopKeys = ["cpu","gpu","ram","ssd","screen","hz","matrix","os"];
  laptopKeys.forEach(k=>{
    if(params[k]) list = list.filter(p=>p.laptop && p.laptop[k]===params[k]);
  });

  // sort
  const sort = params.sort || "pop";
  if(sort==="pop") list.sort((a,b)=>(b.popularity||0)-(a.popularity||0));
  if(sort==="new") list.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));
  if(sort==="priceAsc") list.sort((a,b)=>a.priceKZT-b.priceKZT);
  if(sort==="priceDesc") list.sort((a,b)=>b.priceKZT-a.priceKZT);

  return list;
}

function renderList(params){
  const list = filterProducts(params);
  const wrap = document.getElementById("products");
  const empty = document.getElementById("emptyMsg");
  wrap.innerHTML = "";

  document.getElementById("count").textContent = `${list.length} —Ç–æ–≤–∞—Ä–æ–≤`;

  // crumb
  const catObj = CATEGORIES.find(c=>c.id===params.cat) || CATEGORIES[0];
  document.getElementById("crumb").textContent = catObj.name[state.lang] || catObj.name.ru;

  if(!list.length){
    empty.style.display = "block";
    return;
  }
  empty.style.display = "none";

  list.forEach(p=>{
    const isWish = state.wish.includes(p.id);
    const isCmp = state.cmp.includes(p.id);
    const laptop = p.laptop;

    const keySpecs = laptop ? `
      <div class="specs">
        <span class="pill">${laptop.cpu}</span>
        <span class="pill">${laptop.gpu}</span>
        <span class="pill">${laptop.ram}</span>
        <span class="pill">${laptop.ssd}</span>
        <span class="pill">${laptop.screen} ‚Ä¢ ${laptop.hz}</span>
      </div>` : `<div class="specs"><span class="pill">${p.brand}</span></div>`;

    const priceHtml = `
      <div class="price">
        <b>${fmtMoney(p.priceKZT, state.cur)}</b>
        ${p.oldPriceKZT ? `<s>${fmtMoney(p.oldPriceKZT, state.cur)}</s>` : ""}
      </div>`;

    const actionPrimary = p.quoteOnly
      ? `<button class="btn primary" type="button" data-act="quote" data-id="${p.id}">${t("requestQuote")}</button>`
      : `<button class="btn primary" type="button" data-act="add" data-id="${p.id}">${t("addCart")}</button>`;

    const card = document.createElement("article");
    card.className = "card p";
    card.innerHTML = `
      <img class="pimg" src="images/${p.img}" alt="${productName(p)}" loading="lazy">
      <div class="pbody">
        <div class="meta">
          ${stockPill(p)}
          ${p.stock==="pre" ? `<span class="pill accent">~${p.leadDays||8} –¥–Ω–µ–π</span>` : ""}
        </div>
        <div class="pname">${productName(p)}</div>
        ${priceHtml}
        ${keySpecs}
        ${p.stock==="pre" ? `<div class="small muted">${t("preorderHint")}</div>` : ""}
        <div class="pactions">
          ${actionPrimary}
          <button class="btn" type="button" data-act="one" data-id="${p.id}">${t("oneClick")}</button>
          <button class="mini ${isWish?"on":""}" type="button" data-act="wish" data-id="${p.id}" aria-label="${t("wish")}">‚ù§</button>
          <button class="mini ${isCmp?"on":""}" type="button" data-act="cmp" data-id="${p.id}" aria-label="${t("cmp")}">‚â°</button>
          <button class="btn ghost" type="button" data-act="open" data-id="${p.id}">${t("details")}</button>
        </div>
      </div>
    `;
    wrap.appendChild(card);
  });
}

/* ===== Modal / overlay ===== */
const overlay = document.getElementById("overlay");
const modal = document.getElementById("modal");
const mTitle = document.getElementById("mTitle");
const mBody = document.getElementById("mBody");

function modalOpen(title, html){
  mTitle.textContent = title;
  mBody.innerHTML = html;
  overlay.classList.add("show");
  modal.classList.add("show");
  overlay.setAttribute("aria-hidden","false");
  overlay.focus();
}
function modalClose(){
  overlay.classList.remove("show");
  modal.classList.remove("show");
  overlay.setAttribute("aria-hidden","true");
  mBody.innerHTML = "";
}
document.getElementById("mClose").addEventListener("click", modalClose);
overlay.addEventListener("click", modalClose);

/* ===== Cart / wishlist / compare storage ===== */
function cartKey(id, vid){ return id + "::" + String(vid||1); }
function addToCart(p, vid){
  const v = p.variants.find(x=>String(x.vid)===String(vid)) || p.variants[0];
  if(p.quoteOnly){
    requestQuote(p, v);
    return;
  }
  const key = cartKey(p.id, v.vid);
  const idx = state.cart.findIndex(x=>x.key===key);
  if(idx>=0) state.cart[idx].qty += 1;
  else state.cart.push({
    key,
    sku: p.id,
    name: productName(p),
    img: p.img,
    qty: 1,
    vid: v.vid,
    variantName: v.name,
    priceKZT: v.priceKZT,
    stock: (v.stock==="in") ? t("inStock") : t("preorder")
  });
  saveState(state); setCounts();
}
function toggleWish(id){
  const i = state.wish.indexOf(id);
  if(i>=0) state.wish.splice(i,1);
  else state.wish.push(id);
  saveState(state); setCounts();
}
function toggleCmp(id){
  const i = state.cmp.indexOf(id);
  if(i>=0) state.cmp.splice(i,1);
  else {
    if(state.cmp.length>=4){
      alert("–ú–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å –¥–æ 4 —Ç–æ–≤–∞—Ä–æ–≤.");
      return;
    }
    state.cmp.push(id);
  }
  saveState(state); setCounts();
}

/* ===== PDP (product modal) ===== */
function renderPDP(p){
  const tdesc = p.desc?.[state.lang] || p.desc?.ru || "";
  const laptop = p.laptop;
  const specsRows = [];
  specsRows.push(["SKU", p.id]);
  specsRows.push(["–ë—Ä–µ–Ω–¥", p.brand]);
  if(laptop){
    specsRows.push(["CPU", laptop.cpu]);
    specsRows.push(["GPU", laptop.gpu]);
    specsRows.push(["RAM", laptop.ram]);
    specsRows.push(["SSD", laptop.ssd]);
    specsRows.push(["–≠–∫—Ä–∞–Ω", `${laptop.screen} / ${laptop.hz} / ${laptop.matrix}`]);
    specsRows.push(["–û–°", laptop.os]);
  } else {
    specsRows.push(["–ö–∞—Ç–µ–≥–æ—Ä–∏—è", (CATEGORIES.find(c=>c.id===p.cat)?.name[state.lang] || p.cat)]);
  }
  specsRows.push(["–ù–∞–ª–∏—á–∏–µ", p.stock==="in" ? t("inStock") : t("preorder")]);
  if(p.stock==="pre") specsRows.push(["–°—Ä–æ–∫", t("preorderHint")]);

  const docsHtml = (p.docs && p.docs.length)
    ? p.docs.map(d=>`<div class="doclink"><div><b>${d.name}</b><small>${d.note||""}</small></div><span class="muted">‚Üó</span></div>`).join("")
    : `<div class="small muted">${t("empty")}</div>`;

  const warnHtml = p.warning ? `<div class="warnbox"><b>${t("important")}:</b><div class="small" style="margin-top:6px">${p.warning}</div></div>` : "";

  const variants = p.variants || [{vid:1,name:"–°—Ç–∞–Ω–¥–∞—Ä—Ç",priceKZT:p.priceKZT,stock:p.stock}];
  const vOpts = variants.map(v=>`<option value="${v.vid}">${v.name} ‚Äî ${fmtMoney(v.priceKZT, state.cur)} ‚Ä¢ ${v.stock==="in"?t("inStock"):t("preorder")}</option>`).join("");

  const actionPrimary = p.quoteOnly
    ? `<button class="btn primary" type="button" data-act="quoteNow" data-id="${p.id}">${t("requestQuote")}</button>`
    : `<button class="btn primary" type="button" data-act="addNow" data-id="${p.id}">${t("addCart")}</button>`;

  const html = `
    <div class="pdp">
      <div class="gallery">
        <img src="images/${p.img}" alt="${productName(p)}">
      </div>
      <div>
        <h1>${productName(p)}</h1>
        <div class="meta">
          ${stockPill(p)}
          ${p.stock==="pre" ? `<span class="pill accent">~${p.leadDays||8} –¥–Ω–µ–π</span>` : ""}
          ${p.quoteOnly ? `<span class="pill accent">${t("requestQuote")}</span>` : ""}
        </div>

        <div class="price" style="margin:8px 0 10px">
          <b id="pdpPrice">${fmtMoney(p.priceKZT, state.cur)}</b>
          ${p.oldPriceKZT ? `<s>${fmtMoney(p.oldPriceKZT, state.cur)}</s>` : ""}
        </div>

        ${p.stock==="pre" ? `<div class="small muted" style="margin-bottom:10px">${t("preorderHint")}</div>` : ""}

        <div class="field">
          <label>–í–∞—Ä–∏–∞–Ω—Ç / –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</label>
          <select id="variantSel">${vOpts}</select>
        </div>

        <div class="tabs" role="tablist" aria-label="–í–∫–ª–∞–¥–∫–∏">
          <button class="tab on" type="button" data-tab="specs">${t("specs")}</button>
          <button class="tab" type="button" data-tab="desc">${t("desc")}</button>
          <button class="tab" type="button" data-tab="docs">${t("docs")}</button>
        </div>

        <div id="tab-specs">
          <table class="tbl">
            ${specsRows.map(r=>`<tr><td class="muted">${r[0]}</td><td><b>${r[1]}</b></td></tr>`).join("")}
          </table>
          <div style="margin-top:10px">${warnHtml}</div>
        </div>

        <div id="tab-desc" style="display:none">
          <div class="small">${tdesc}</div>
        </div>

        <div id="tab-docs" style="display:none">
          ${docsHtml}
        </div>

        <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap">
          ${actionPrimary}
          <button class="btn" type="button" data-act="buyNow" data-id="${p.id}">${t("buyNow")}</button>
          <button class="btn" type="button" data-act="oneNow" data-id="${p.id}">${t("oneClick")}</button>
          <button class="btn" type="button" data-act="askNow" data-id="${p.id}">${t("ask")}</button>
        </div>

        <div class="small muted" style="margin-top:10px">
          –î–æ—Å—Ç–∞–≤–∫–∞/–æ–ø–ª–∞—Ç–∞/–≥–∞—Ä–∞–Ω—Ç–∏—è ‚Äî —É—Ç–æ—á–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞.
        </div>
      </div>
    </div>
  `;
  modalOpen(productName(p), html);

  // tabs
  mBody.querySelectorAll(".tab").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      mBody.querySelectorAll(".tab").forEach(x=>x.classList.remove("on"));
      btn.classList.add("on");
      const tab = btn.dataset.tab;
      ["specs","desc","docs"].forEach(k=>{
        const el = mBody.querySelector("#tab-"+k);
        if(el) el.style.display = (k===tab) ? "block" : "none";
      });
    });
  });

  // variants price update
  const variantSel = mBody.querySelector("#variantSel");
  const priceEl = mBody.querySelector("#pdpPrice");
  variantSel.addEventListener("change", ()=>{
    const vid = variantSel.value;
    const v = p.variants.find(x=>String(x.vid)===String(vid)) || p.variants[0];
    priceEl.textContent = fmtMoney(v.priceKZT, state.cur);
  });

  // actions in pdp
  mBody.addEventListener("click", (e)=>{
    const b = e.target.closest("button");
    if(!b) return;
    const act = b.dataset.act;
    if(!act) return;
    const vid = mBody.querySelector("#variantSel")?.value || 1;

    if(act==="addNow"){ addToCart(p, vid); alert("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É"); }
    if(act==="quoteNow"){ requestQuote(p, p.variants.find(x=>String(x.vid)===String(vid))||p.variants[0]); }
    if(act==="buyNow"){ addToCart(p, vid); openCart(); }
    if(act==="oneNow"){ openOneClick(p, vid); }
    if(act==="askNow"){ openWA(`–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –í–æ–ø—Ä–æ—Å –ø–æ —Ç–æ–≤–∞—Ä—É: ${productName(p)} (${p.id}).`); }
  });
}

/* ===== One-click ===== */
function openOneClick(p, vid){
  const v = p.variants.find(x=>String(x.vid)===String(vid)) || p.variants[0];
  const html = `
    <div class="card pad" style="box-shadow:none; border:none">
      <div class="small muted" style="margin-bottom:10px">–ö—É–ø–∏—Ç—å –≤ 1 –∫–ª–∏–∫ ‚Äî –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω</div>
      <div class="field"><label>–ò–º—è</label><input id="ocName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–∞–ª—Ç–∞–Ω–∞—Ç"></div>
      <div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input id="ocPhone" placeholder="+7 ..."></div>
      <div class="field"><label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><input id="ocComm" placeholder="–ì–æ—Ä–æ–¥, —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞..."></div>
      <button class="btn primary" id="ocSend" type="button">${t("send")}</button>
      <div class="small muted" style="margin-top:8px">–¢–æ–≤–∞—Ä: <b>${productName(p)}</b> ‚Ä¢ –í–∞—Ä–∏–∞–Ω—Ç: <b>${v.name}</b></div>
    </div>
  `;
  modalOpen(t("oneClick"), html);
  document.getElementById("ocSend").addEventListener("click", ()=>{
    const name = document.getElementById("ocName").value.trim();
    const phone = document.getElementById("ocPhone").value.trim();
    const comm = document.getElementById("ocComm").value.trim();
    const text =
`–ó–∞—è–≤–∫–∞: –ö—É–ø–∏—Ç—å –≤ 1 –∫–ª–∏–∫
–¢–æ–≤–∞—Ä: ${productName(p)} (${p.id})
–í–∞—Ä–∏–∞–Ω—Ç: ${v.name}
–¶–µ–Ω–∞ (–±–∞–∑–∞): ${p.priceKZT} KZT
–ò–º—è: ${name}
–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}
–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comm||"-"}
–ù–∞–ª–∏—á–∏–µ: ${p.stock==="in"?t("inStock"):t("preorder")}
${p.stock==="pre" ? ("–°—Ä–æ–∫: "+t("preorderHint")) : ""}
(–°–∞–π—Ç JOHNGALTAZ)`;
    openWA(text);
  });
}

/* ===== Quote request (for medical/cosmo, or manual) ===== */
function requestQuote(p, v){
  const text =
`–ó–∞–ø—Ä–æ—Å –ö–ü / –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
–¢–æ–≤–∞—Ä: ${productName(p)} (${p.id})
–í–∞—Ä–∏–∞–Ω—Ç: ${v?.name || "-"}
–¶–µ–Ω–∞ (–µ—Å–ª–∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä): ${p.priceKZT} KZT
–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${(CATEGORIES.find(c=>c.id===p.cat)?.name.ru || p.cat)}
–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: –ü—Ä–æ—à—É –ö–ü, —Å—Ä–æ–∫–∏ –∏ —É—Å–ª–æ–≤–∏—è.
(–°–∞–π—Ç JOHNGALTAZ)`;
  openWA(text);
}

/* ===== Cart & Checkout ===== */
function openCart(){
  const lang = state.lang;
  if(!state.cart.length){
    modalOpen(t("cart"), `<p class="muted">${t("empty")}</p>`);
    return;
  }
  const rows = state.cart.map(it=>{
    const p = PRODUCTS.find(x=>x.id===it.sku);
    const img = p?.img || it.img || "tovar1.jpg";
    const name = p ? productName(p) : it.name || it.sku;
    const line = (it.priceKZT||0)*it.qty;
    const lead = (p && p.stock==="pre") ? `<div class="small muted">${t("preorderHint")}</div>` : "";
    return `
      <div class="card pad" style="margin-bottom:10px">
        <div style="display:grid; grid-template-columns:76px 1fr; gap:10px; align-items:center">
          <img src="images/${img}" style="width:76px;height:76px;border-radius:16px;object-fit:cover;border:1px solid rgba(214,214,214,.65)" alt="">
          <div>
            <b>${name}</b>
            <div class="small muted">${it.variantName||""}</div>
            ${lead}
            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px">
              <button class="btn" type="button" data-act="dec" data-key="${it.key}">‚àí</button>
              <input value="${it.qty}" data-act="qty" data-key="${it.key}" style="width:68px; text-align:center; padding:10px 12px; border-radius:14px; border:1px solid var(--line)">
              <button class="btn" type="button" data-act="inc" data-key="${it.key}">+</button>
              <button class="btn" type="button" data-act="rm" data-key="${it.key}">${t("remove")}</button>
              <span style="margin-left:auto"><b>${fmtMoney(line, state.cur)}</b></span>
            </div>
          </div>
        </div>
      </div>
    `;
  }).join("");

  const totalKZT = state.cart.reduce((sum,it)=>sum + (it.priceKZT||0)*it.qty, 0);

  const html = `
    <div class="cmphead">
      <div>
        <b>${t("cart")}</b>
        <div class="small muted">${state.cart.length} –ø–æ–∑–∏—Ü–∏–π</div>
      </div>
      <div>
        <span class="pill">${t("total")}: <b>${fmtMoney(totalKZT, state.cur)}</b></span>
      </div>
    </div>
    ${rows}
    <button class="btn primary" id="toCheckout" type="button">${t("checkout")}</button>
  `;

  modalOpen(t("cart"), html);

  // cart actions
  mBody.addEventListener("click", (e)=>{
    const b = e.target.closest("button");
    if(!b) return;
    const act = b.dataset.act;
    const key = b.dataset.key;
    if(!act || !key) return;
    const idx = state.cart.findIndex(x=>x.key===key);
    if(idx<0) return;
    if(act==="inc") state.cart[idx].qty += 1;
    if(act==="dec") state.cart[idx].qty = Math.max(1, state.cart[idx].qty - 1);
    if(act==="rm") state.cart.splice(idx,1);
    saveState(state); setCounts(); openCart();
  });

  document.getElementById("toCheckout").addEventListener("click", openCheckout);
}

function openCheckout(){
  if(!state.cart.length){
    modalOpen(t("checkout"), `<p class="muted">${t("empty")}</p>`);
    return;
  }
  const totalKZT = state.cart.reduce((sum,it)=>sum + (it.priceKZT||0)*it.qty, 0);

  const html = `
    <div class="pdp" style="grid-template-columns:1fr 1fr">
      <div>
        <b>${t("checkout")}</b>
        <div class="small muted" style="margin-top:6px">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è ‚Äî –∑–∞–∫–∞–∑/–∑–∞—è–≤–∫–∞ —É–π–¥—ë—Ç –≤ WhatsApp –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</div>
        <div class="hr"></div>

        <div class="field"><label>–§–ò–û</label><input id="chName" placeholder="–§–∞–º–∏–ª–∏—è –ò–º—è"></div>
        <div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input id="chPhone" placeholder="+7 ..."></div>
        <div class="field"><label>${t("city")}</label><input id="chCity" placeholder="–ê–ª–º–∞—Ç—ã / –ê—Å—Ç–∞–Ω–∞ / ..."></div>
        <div class="field"><label>${t("address")}</label><input id="chAddr" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤"></div>

        <div class="field"><label>${t("delivery")}</label>
          <select id="chDel">
            <option>–ö—É—Ä—å–µ—Ä</option>
            <option>–°–∞–º–æ–≤—ã–≤–æ–∑</option>
            <option>–°–î–≠–ö</option>
            <option>Boxberry</option>
            <option>–ö–∞–∑–ø–æ—á—Ç–∞</option>
          </select>
        </div>

        <div class="field"><label>${t("pay")}</label>
          <select id="chPay">
            <option>Kaspi (–ø–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)</option>
            <option>–ö–∞—Ä—Ç–∞</option>
            <option>–ü–µ—Ä–µ–≤–æ–¥</option>
            <option>–ù–∞–ª–∏—á–Ω—ã–µ</option>
          </select>
        </div>

        <div class="field"><label>${t("comment")}</label><input id="chComm" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"></div>

        <div class="field">
          <label style="display:flex; align-items:center; gap:10px">
            <input type="checkbox" id="chB2B">
            <span><b>${t("b2b")}</b> (B2B)</span>
          </label>
        </div>

        <div id="b2bFields" style="display:none">
          <div class="field"><label>${t("company")}</label><input id="chCompany" placeholder="–¢–û–û ..."></div>
          <div class="field"><label>${t("bin")}</label><input id="chBIN" placeholder="–ë–ò–ù/–ò–ù–ù"></div>
          <div class="field"><label>${t("email")}</label><input id="chEmail" placeholder="accounting@company.kz"></div>
          <div class="field"><label>${t("contact")}</label><input id="chContact" placeholder="–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ"></div>
          <div class="field"><label>${t("attach")}</label><input type="file" id="chFile" /></div>
          <div class="small muted">–§–∞–π–ª –Ω–∞ —Å—Ç–∞—Ç–∏–∫–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî —É–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –≥–æ—Ç–æ–≤—ã –≤—ã—Å–ª–∞—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã, –∏ –∞–¥–º–∏–Ω –∑–∞–ø—Ä–æ—Å–∏—Ç.</div>
        </div>

        <div class="hr"></div>
        <button class="btn primary" id="chSend" type="button">${t("send")}</button>
      </div>

      <div>
        <b>${t("cart")}</b>
        <div class="small muted" style="margin-top:6px">${state.cart.length} –ø–æ–∑–∏—Ü–∏–π ‚Ä¢ ${t("total")}: <b>${fmtMoney(totalKZT, state.cur)}</b></div>
        <div class="hr"></div>
        ${state.cart.map(it=>{
          const p = PRODUCTS.find(x=>x.id===it.sku);
          const name = p ? productName(p) : it.name;
          const lead = (p && p.stock==="pre") ? ` ‚Ä¢ (~${p.leadDays||8}d)` : "";
          return `<div class="doclink"><div><b>${name}</b><small>${it.variantName||""}${lead}</small></div><small>${it.qty} —à—Ç</small></div>`;
        }).join("")}
        <div class="hr"></div>
        <div class="warnbox">
          <b>–°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞ (–º–∞–∫–µ—Ç):</b>
          <div class="small" style="margin-top:6px">–Ω–æ–≤—ã–π ‚Üí –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω ‚Üí –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω / –æ—Ç–º–µ–Ω–µ–Ω</div>
        </div>
      </div>
    </div>
  `;

  modalOpen(t("checkout"), html);

  const b2b = document.getElementById("chB2B");
  b2b.addEventListener("change", ()=>{
    document.getElementById("b2bFields").style.display = b2b.checked ? "block" : "none";
  });

  document.getElementById("chSend").addEventListener("click", ()=>{
    const name = document.getElementById("chName").value.trim();
    const phone = document.getElementById("chPhone").value.trim();
    const city = document.getElementById("chCity").value.trim();
    const addr = document.getElementById("chAddr").value.trim();
    const del = document.getElementById("chDel").value;
    const pay = document.getElementById("chPay").value;
    const comm = document.getElementById("chComm").value.trim();

    let text =
`–ó–∞–∫–∞–∑ (–Ω–æ–≤—ã–π)
–§–ò–û: ${name}
–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}
–ì–æ—Ä–æ–¥: ${city}
–ê–¥—Ä–µ—Å: ${addr}
–î–æ—Å—Ç–∞–≤–∫–∞: ${del}
–û–ø–ª–∞—Ç–∞: ${pay}
–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comm || "-"}
–°–æ—Å—Ç–∞–≤:`;

    state.cart.forEach(it=>{
      const p = PRODUCTS.find(x=>x.id===it.sku);
      const lead = (p && p.stock==="pre") ? ` | –ø—Ä–µ–¥–∑–∞–∫–∞–∑ (~${p.leadDays||8} –¥–Ω–µ–π)` : "";
      text += `\n- ${it.sku}: ${ (p?productName(p):it.name) } | ${it.variantName||""} | qty: ${it.qty} | —Ü–µ–Ω–∞: ${it.priceKZT} KZT${lead}`;
    });

    text += `\n–ò—Ç–æ–≥–æ (–±–∞–∑–∞): ${totalKZT} KZT`;

    if(b2b.checked){
      const company = document.getElementById("chCompany").value.trim();
      const bin = document.getElementById("chBIN").value.trim();
      const email = document.getElementById("chEmail").value.trim();
      const contact = document.getElementById("chContact").value.trim();
      text += `\n\nB2B: –î–∞
–ö–æ–º–ø–∞–Ω–∏—è: ${company}
–ë–ò–ù/–ò–ù–ù: ${bin}
Email: ${email}
–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ: ${contact}
–†–µ–∫–≤–∏–∑–∏—Ç—ã: —Ñ–∞–π–ª –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ (–∑–∞–ø—Ä–æ—Å–∏—Ç–µ —É –∫–ª–∏–µ–Ω—Ç–∞)`;
    }

    text += `\n(–°–∞–π—Ç JOHNGALTAZ)`;

    openWA(text);
  });
}

/* ===== Wishlist ===== */
function openWishlist(){
  if(!state.wish.length){
    modalOpen(t("wishlist"), `<p class="muted">${t("empty")}</p>`);
    return;
  }
  const list = state.wish.map(id=>PRODUCTS.find(p=>p.id===id)).filter(Boolean);
  const html = `
    <div class="cmphead">
      <div><b>${t("wishlist")}</b><div class="small muted">${list.length} —Ç–æ–≤–∞—Ä–æ–≤</div></div>
      <div><button class="btn" type="button" id="wishClear">${t("reset")}</button></div>
    </div>
    ${list.map(p=>`
      <div class="doclink">
        <div>
          <b>${productName(p)}</b>
          <small>${p.brand} ‚Ä¢ ${p.stock==="in"?t("inStock"):t("preorder")}</small>
        </div>
        <div style="display:flex; gap:8px; align-items:center">
          <button class="btn" type="button" data-act="open" data-id="${p.id}">${t("details")}</button>
          <button class="btn" type="button" data-act="rmWish" data-id="${p.id}">${t("remove")}</button>
        </div>
      </div>
    `).join("")}
  `;
  modalOpen(t("wishlist"), html);

  document.getElementById("wishClear").addEventListener("click", ()=>{
    state.wish = [];
    saveState(state); setCounts(); openWishlist();
  });

  mBody.addEventListener("click", (e)=>{
    const b = e.target.closest("button");
    if(!b) return;
    const id = b.dataset.id;
    if(b.dataset.act==="open" && id){
      const p = PRODUCTS.find(x=>x.id===id);
      if(p) renderPDP(p);
    }
    if(b.dataset.act==="rmWish" && id){
      toggleWish(id);
      openWishlist();
    }
  });
}

/* ===== Compare ===== */
function openCompare(){
  if(!state.cmp.length){
    modalOpen(t("compare"), `<p class="muted">${t("empty")}</p>`);
    return;
  }
  const list = state.cmp.map(id=>PRODUCTS.find(p=>p.id===id)).filter(Boolean);
  const cols = list.length;

  // Auto spec grouping: collect keys
  const baseKeys = ["brand","stock"];
  const lapKeys = ["cpu","gpu","ram","ssd","screen","hz","matrix","os"];
  const rows = [];

  rows.push(["–ù–∞–∑–≤–∞–Ω–∏–µ", ...list.map(p=>productName(p))]);
  rows.push(["–¶–µ–Ω–∞", ...list.map(p=>fmtMoney(p.priceKZT, state.cur))]);
  rows.push(["–ù–∞–ª–∏—á–∏–µ", ...list.map(p=>p.stock==="in"?t("inStock"):t("preorder"))]);

  // for laptops
  const anyLaptop = list.some(p=>p.laptop);
  if(anyLaptop){
    lapKeys.forEach(k=>{
      rows.push([k.toUpperCase(), ...list.map(p=>p.laptop ? (p.laptop[k]||"-") : "-")]);
    });
  } else {
    rows.push(["–ö–∞—Ç–µ–≥–æ—Ä–∏—è", ...list.map(p=>CATEGORIES.find(c=>c.id===p.cat)?.name[state.lang] || p.cat)]);
  }

  // diff highlight
  const htmlRows = rows.map(r=>{
    const vals = r.slice(1);
    const isDiff = new Set(vals).size > 1;
    return `
      <tr class="${isDiff ? "diff" : ""}">
        <th>${r[0]}</th>
        ${vals.map(v=>`<td>${v}</td>`).join("")}
      </tr>
    `;
  }).join("");

  const html = `
    <div class="cmphead">
      <div>
        <b>${t("compare")}</b>
        <div class="small muted">–¥–æ 4 —Ç–æ–≤–∞—Ä–æ–≤ ‚Ä¢ –æ—Ç–ª–∏—á–∏—è –ø–æ–¥—Å–≤–µ—á–µ–Ω—ã</div>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <button class="btn" type="button" id="cmpClear">${t("reset")}</button>
        <button class="btn primary" type="button" id="cmpToCart">${t("addCart")}</button>
      </div>
    </div>
    <div class="cmpwrap">
      <table class="cmptbl">
        <thead>
          <tr>
            <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
            ${list.map(p=>`<th>${p.id}</th>`).join("")}
          </tr>
        </thead>
        <tbody>
          ${htmlRows}
        </tbody>
      </table>
    </div>
    <div class="small muted" style="margin-top:10px">–ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ:</div>
    ${list.map(p=>`
      <div class="doclink">
        <div><b>${productName(p)}</b><small>${p.brand}</small></div>
        <div style="display:flex; gap:8px; align-items:center">
          <button class="btn" type="button" data-act="open" data-id="${p.id}">${t("details")}</button>
          <button class="btn" type="button" data-act="rmCmp" data-id="${p.id}">${t("remove")}</button>
        </div>
      </div>
    `).join("")}
  `;
  modalOpen(t("compare"), html);

  document.getElementById("cmpClear").addEventListener("click", ()=>{
    state.cmp = [];
    saveState(state); setCounts(); openCompare();
  });

  document.getElementById("cmpToCart").addEventListener("click", ()=>{
    // –î–æ–±–∞–≤–∏–º –ø–µ—Ä–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω—É (–µ—Å–ª–∏ –Ω–µ quoteOnly)
    list.forEach(p=>{
      if(!p.quoteOnly) addToCart(p, p.variants[0]?.vid || 1);
    });
    alert("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É (–≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ).");
    openCart();
  });

  mBody.addEventListener("click", (e)=>{
    const b = e.target.closest("button");
    if(!b) return;
    const id = b.dataset.id;
    if(b.dataset.act==="open" && id){
      const p = PRODUCTS.find(x=>x.id===id);
      if(p) renderPDP(p);
    }
    if(b.dataset.act==="rmCmp" && id){
      toggleCmp(id);
      openCompare();
    }
  });
}

/* ===== Events ===== */
document.getElementById("langSel").addEventListener("change", (e)=>{
  state.lang = e.target.value;
  saveState(state);
  refreshCatNames();
  applyI18N();
  hydrateFromQS(); // –ø–µ—Ä–µ—Ä–∏—Å—É–µ–º
});
document.getElementById("curSel").addEventListener("change", (e)=>{
  state.cur = e.target.value;
  saveState(state);
  hydrateFromQS();
});
document.getElementById("hambBtn").addEventListener("click", ()=>{
  document.getElementById("nav").classList.toggle("open");
});

document.getElementById("cartBtn").addEventListener("click", openCart);
document.getElementById("wishBtn").addEventListener("click", openWishlist);
document.getElementById("cmpBtn").addEventListener("click", openCompare);
document.getElementById("openCheckout").addEventListener("click", openCheckout);

document.getElementById("askWA").addEventListener("click", ()=>openWA("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ù—É–∂–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ —Ç–æ–≤–∞—Ä–∞–º JOHNGALTAZ."));
document.getElementById("fabWA").addEventListener("click", ()=>openWA("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ù—É–∂–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ —Ç–æ–≤–∞—Ä–∞–º JOHNGALTAZ."));

document.getElementById("qBtn").addEventListener("click", ()=>{
  document.getElementById("q").value = document.getElementById("qTop").value;
  document.getElementById("applyBtn").click();
});
document.getElementById("qTop").addEventListener("keydown", (e)=>{
  if(e.key==="Enter"){ e.preventDefault(); document.getElementById("qBtn").click(); }
});

document.getElementById("applyBtn").addEventListener("click", ()=>{
  const params = collectParamsFromUI();
  qsSet(params);
  renderList(params);
});
document.getElementById("resetBtn").addEventListener("click", ()=>{
  const params = { sort: document.getElementById("sortSel").value || "pop" };
  qsSet(params);
  hydrateFromQS();
});

document.getElementById("sortSel").addEventListener("change", ()=>{
  const params = collectParamsFromUI();
  params.sort = document.getElementById("sortSel").value;
  qsSet(params);
  renderList(params);
});

// Click on product card actions
document.getElementById("products").addEventListener("click", (e)=>{
  const btn = e.target.closest("button");
  if(!btn) return;
  const act = btn.dataset.act;
  const id = btn.dataset.id;
  const p = PRODUCTS.find(x=>x.id===id);
  if(!act || !p) return;

  if(act==="open") renderPDP(p);
  if(act==="add") { addToCart(p, 1); alert("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É"); }
  if(act==="one") openOneClick(p, 1);
  if(act==="wish") { toggleWish(id); hydrateFromQS(); }
  if(act==="cmp") { toggleCmp(id); hydrateFromQS(); }
  if(act==="quote") requestQuote(p, p.variants[0]);
});

// Close modal on ESC
document.addEventListener("keydown", (e)=>{
  if(e.key==="Escape") modalClose();
});

/* ===== Collect / hydrate ===== */
function collectParamsFromUI(){
  const params = {};
  params.cat = catSel.value || "";
  params.q = document.getElementById("q").value.trim();
  params.pMin = document.getElementById("pMin").value.trim();
  params.pMax = document.getElementById("pMax").value.trim();
  params.brand = brandSel.value || "";
  params.stock = document.getElementById("stockSel").value || "";

  // laptop filters only when category laptops or when some laptop filter set
  params.cpu = cpuSel.value || "";
  params.gpu = gpuSel.value || "";
  params.ram = ramSel.value || "";
  params.ssd = ssdSel.value || "";
  params.screen = screenSel.value || "";
  params.hz = hzSel.value || "";
  params.matrix = matrixSel.value || "";
  params.os = osSel.value || "";

  params.sort = document.getElementById("sortSel").value || "pop";
  return params;
}

function hydrateFromQS(){
  const params = qsParse();

  // if passed from index
  state.lang = (params.lang && I18N[params.lang]) ? params.lang : state.lang;
  state.cur = (params.cur && FX[params.cur]!=null) ? params.cur : state.cur;

  document.getElementById("langSel").value = state.lang;
  document.getElementById("curSel").value = state.cur;

  refreshCatNames();
  applyI18N();
  setCounts();

  // set UI from params
  catSel.value = params.cat || "";
  document.getElementById("q").value = params.q || "";
  document.getElementById("qTop").value = params.q || "";

  document.getElementById("pMin").value = params.pMin || "";
  document.getElementById("pMax").value = params.pMax || "";
  brandSel.value = params.brand || "";
  document.getElementById("stockSel").value = params.stock || "";

  cpuSel.value = params.cpu || "";
  gpuSel.value = params.gpu || "";
  ramSel.value = params.ram || "";
  ssdSel.value = params.ssd || "";
  screenSel.value = params.screen || "";
  hzSel.value = params.hz || "";
  matrixSel.value = params.matrix || "";
  osSel.value = params.os || "";

  document.getElementById("sortSel").value = params.sort || "pop";

  // show/hide laptop filters
  const showLaptop = (catSel.value==="laptops") || ["cpu","gpu","ram","ssd","screen","hz","matrix","os"].some(k=>params[k]);
  document.getElementById("laptopFilters").style.display = showLaptop ? "block" : "none";

  // price hint
  const relevant = filterProducts({cat: params.cat || "", q: params.q || "", brand: params.brand || "" , stock: params.stock || ""});
  const prices = relevant.map(p=>p.priceKZT);
  const min = prices.length ? Math.min(...prices) : 0;
  const max = prices.length ? Math.max(...prices) : 0;
  document.getElementById("priceHint").textContent = prices.length ? `–î–∏–∞–ø–∞–∑–æ–Ω –ø–æ —Ç–µ–∫—É—â–µ–π –≤—ã–±–æ—Ä–∫–µ: ${min} ‚Äî ${max} KZT` : "";

  renderList(params);

  // optional open panels
  if(params.open==="cart") openCart();
  if(params.open==="oneclick"){
    // –æ—Ç–∫—Ä—ã–≤–∞–µ–º 1-–∫–ª–∏–∫ –±–µ–∑ —Ç–æ–≤–∞—Ä–∞ ‚Äî –∫–∞–∫ –æ–±—â—É—é –∑–∞—è–≤–∫—É
    modalOpen(t("oneClick"), `
      <div class="card pad" style="box-shadow:none; border:none">
        <div class="small muted" style="margin-bottom:10px">–ö—É–ø–∏—Ç—å –≤ 1 –∫–ª–∏–∫ ‚Äî –æ–±—â–∞—è –∑–∞—è–≤–∫–∞</div>
        <div class="field"><label>–ò–º—è</label><input id="ocName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–∞–ª—Ç–∞–Ω–∞—Ç"></div>
        <div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input id="ocPhone" placeholder="+7 ..."></div>
        <div class="field"><label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><input id="ocComm" placeholder="–ö–∞–∫–æ–π —Ç–æ–≤–∞—Ä –Ω—É–∂–µ–Ω?"></div>
        <button class="btn primary" id="ocSend" type="button">${t("send")}</button>
      </div>
    `);
    document.getElementById("ocSend").addEventListener("click", ()=>{
      const name = document.getElementById("ocName").value.trim();
      const phone = document.getElementById("ocPhone").value.trim();
      const comm = document.getElementById("ocComm").value.trim();
      openWA(`–ó–∞—è–≤–∫–∞: –ö—É–ø–∏—Ç—å –≤ 1 –∫–ª–∏–∫ (–æ–±—â–∞—è)\n–ò–º—è: ${name}\n–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comm||"-"}\n(–°–∞–π—Ç JOHNGALTAZ)`);
    });
  }

  // open by SKU from index drawer links
  if(params.wish){
    const p = PRODUCTS.find(x=>x.id===params.wish);
    if(p) renderPDP(p);
  }
  if(params.cmp){
    const p = PRODUCTS.find(x=>x.id===params.cmp);
    if(p) renderPDP(p);
  }
}

// init from URL
setCounts();
applyI18N();
hydrateFromQS();

// persist language/currency to state when page loads
saveState(state);
</script>
</body>
</html>
